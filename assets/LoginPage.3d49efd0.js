import{Q as y}from"./QBtn.8614fb17.js";import{A as h,S as g,Q as b,D as B}from"./DialogComponent.53fbea4d.js";import{P as E,_ as P,d as K,j as l,o as x,b as L,f as n,E as S,F as T,z as m,G as v,e as d,w as u,g as _,H as F,I as C,u as D,p as I,h as U}from"./index.5dab7d6a.js";import{L as V}from"./LoginCredential.c897c66b.js";import"./render.e919e14d.js";const N="PBKDF2",O="SHA-512",k=21e4,A=256;async function H(a){const s=new TextEncoder().encode(a),t=await window.crypto.subtle.importKey("raw",s,{name:"PBKDF2"},!1,["deriveBits"]),o=await window.crypto.subtle.deriveBits({name:N,hash:O,salt:new TextEncoder().encode(""),iterations:k},t,A);return R(o)}function R(a){let s="";const t=new Uint8Array(a),o=t.byteLength;for(let e=0;e<o;e++)s+=String.fromCharCode(t[e]);return window.btoa(s)}class G extends h{constructor(){super()}async doLogin(s,t){const o=await H(t),e=await this.request("POST",g.LOGIN,null,null,{emailOrUsername:s,passwordHash:o});if(e.code==404)throw new Error("User not found, please try again.");if(e.code==403)throw new Error("Invalid password provided, please try again.");if(!e.body)throw new Error("Uh oh, server returned an invalid login response. Try again later.");E.set(V.REFRESH_TOKEN,e.body.jwt)}}const Q=new G;const f=a=>(I("data-v-bbf348ea"),a=a(),U(),a),j={style:{height:"100vh"},class:"row items-center justify-evenly"},M=["onKeydown"],q=f(()=>n("h5",null,"Email or Username:",-1)),z=f(()=>n("h5",null,"Password:",-1)),W=K({__name:"LoginPage",setup(a){const s=D(),t=l(),o=l(),e=l(!1),c=l(""),p=async()=>{try{if(!t.value||!o.value)throw new Error("Please enter both your username and password!");await Q.doLogin(t.value,o.value),await s.replace("/home")}catch(w){c.value=w.message,e.value=!0}};return(w,r)=>(x(),L(C,null,[n("div",j,[n("div",{id:"container",onKeydown:S(T(p,["prevent"]),["enter"])},[n("div",null,[q,m(n("input",{class:"input-form",type:"text","onUpdate:modelValue":r[0]||(r[0]=i=>t.value=i)},null,512),[[v,t.value]])]),n("div",null,[z,m(n("input",{class:"input-form",type:"password","onUpdate:modelValue":r[1]||(r[1]=i=>o.value=i)},null,512),[[v,o.value]])]),d(y,{push:"",onClick:p},{default:u(()=>[_("Login")]),_:1})],40,M)]),d(B,{modelValue:e.value,"onUpdate:modelValue":r[2]||(r[2]=i=>e.value=i),title:"Warning",icon:"report_problem","close-button":"OK"},{default:u(()=>[d(b,{class:"q-pt-none"},{default:u(()=>[_(F(c.value),1)]),_:1})]),_:1},8,["modelValue"])],64))}});var ee=P(W,[["__scopeId","data-v-bbf348ea"]]);export{ee as default};
