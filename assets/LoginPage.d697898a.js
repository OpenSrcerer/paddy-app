import{Q as B}from"./QBtn.943c1570.js";import{A as b,S as E,D as L,L as P,Q as K}from"./LoadingSpinner.ce0eaec1.js";import{P as S,_ as x,d as T,u as F,j as l,o as u,b as f,f as n,c as I,E as C,F as D,z as _,G as y,e as c,w as p,H as k,g,I as U,p as V,h as N}from"./index.d52fd985.js";import{L as O}from"./LoginCredential.c897c66b.js";import"./render.f0915b39.js";const A="PBKDF2",H="SHA-512",R=21e4,G=256;async function Q(a){const s=new TextEncoder().encode(a),t=await window.crypto.subtle.importKey("raw",s,{name:"PBKDF2"},!1,["deriveBits"]),o=await window.crypto.subtle.deriveBits({name:A,hash:H,salt:new TextEncoder().encode(""),iterations:R},t,G);return j(o)}function j(a){let s="";const t=new Uint8Array(a),o=t.byteLength;for(let e=0;e<o;e++)s+=String.fromCharCode(t[e]);return window.btoa(s)}class M extends b{constructor(){super()}async doLogin(s,t){const o=await Q(t),e=await this.request("POST",E.LOGIN,null,null,{emailOrUsername:s,passwordHash:o});if(e.code==404)throw new Error("User not found, please try again.");if(e.code==403)throw new Error("Invalid password provided, please try again.");if(!e.body)throw new Error("Uh oh, server returned an invalid login response. Try again later.");S.set(O.REFRESH_TOKEN,e.body.jwt)}}const q=new M;const h=a=>(V("data-v-3d7331f7"),a=a(),N(),a),z={style:{height:"100vh"},class:"row items-center justify-evenly"},W=["onKeydown"],Y=h(()=>n("h5",null,"Email or Username:",-1)),J=h(()=>n("h5",null,"Password:",-1)),X=T({__name:"LoginPage",setup(a){const s=F(),t=l(),o=l(),e=l(!1),w=l(""),d=l(!1),v=async()=>{try{if(!t.value||!o.value)throw new Error("Please enter both your username and password!");d.value=!0,await q.doLogin(t.value,o.value),await s.replace("/home"),d.value=!1}catch(m){d.value=!1,w.value=m.message,e.value=!0}};return(m,r)=>(u(),f(k,null,[n("div",z,[d.value?(u(),I(P,{key:0})):(u(),f("div",{key:1,id:"container",onKeydown:C(D(v,["prevent"]),["enter"])},[n("div",null,[Y,_(n("input",{class:"input-form",type:"text","onUpdate:modelValue":r[0]||(r[0]=i=>t.value=i)},null,512),[[y,t.value]])]),n("div",null,[J,_(n("input",{class:"input-form",type:"password","onUpdate:modelValue":r[1]||(r[1]=i=>o.value=i)},null,512),[[y,o.value]])]),c(B,{push:"",onClick:v},{default:p(()=>[g("Login")]),_:1})],40,W))]),c(L,{modelValue:e.value,"onUpdate:modelValue":r[2]||(r[2]=i=>e.value=i),title:"Warning",icon:"report_problem","close-button":"OK"},{default:p(()=>[c(K,{class:"q-pt-none"},{default:p(()=>[g(U(w.value),1)]),_:1})]),_:1},8,["modelValue"])],64))}});var ae=x(X,[["__scopeId","data-v-3d7331f7"]]);export{ae as default};
